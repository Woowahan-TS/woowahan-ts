# 6장 타입스크립트 컴파일

## 6.1 자바스크립트의 런타임과 타입스크립트의 컴파일

### 1. 런타임과 컴파일타입

자바스크립트는 대표적인 고수준 언어이다.

- 고수준 언어 : 사람이 이해하기 쉬운 형식으로 작성된 언어
- 저수준 언어 : 컴퓨터가 이해하기 쉬운 형식으로 작성된 언어

자바스크립트는 컴파일러나 인터프리터에 의해 저수준 프로그래밍 언어로 번역되어 실행된다.

`소스코드 -(컴파일러)-> 기계어 코드`

- 컴파일타임 : 소스코드가 컴파일 과정을 거쳐 컴퓨터가 인식할 수 있는 기계어 코드로 변환되어 실행할 수 있는 프로그램이 되는 과정을 의미한다.

### 2. 자바스크립트 런타임

> 자바스크립트가 실행되는 환경 대표적으로 인터넷 브라우저(크롬, 사파리..)와 Node.js 등이 있다.

### 3. 타입스크립트의 컴파일

> 타입스크립트는 tsc 라고 불리는 컴파일러를 통해 자바스크립트 코드로 변환된다. 하지만 타입스크립트의 컴파일은 고수준 언어(타입스크립트)가 또 다른 고수준 언어(자바스크립트)로 변환되는 것이기 때문에 컴파일이 아닌 트랜스파일 이라고 부르기도 한다.

타입스크립트는 .ts 확장자가 붙은 파일을 찾아서 컴파일한 다음 .js 확장자가 붙은 자바스크립트 파일을 만든다.

1. 타입스크립트 소스코드를 타입스크립트 AST 로 만든다.
2. 타입 검사기가 AST 를 확인하여 타입을 확인한다.
3. 타입스크립트 AST 를 자바스크립트 소스로 변환한다.
4. 자바스크립트 소스코드를 자바스크립트 AST 로 만든다.
5. AST 가 바이트 코드로 변환된다.
6. 런타임에서 바이트 코드가 평가되어 프로그램이 실행된다.

`AST(Abstract Syntax Tree) : 컴파일러가 소스코드를 해석하는 과정에서 생성된 데이터 구조이다. 컴파일러는 어휘적 분석과 구문 분석을 통해 소스코드를 노드 단위의 트리 구조로 구성한다.`

- 타입스크립트 소스코드의 타입은 1~2 단계에서만 사용된다. 즉, 타입 정보는 단지 타입을 확인하는 데만 쓰이며, 최종 프로그램에는 영향을 주지 않는다.

## 6.2 타입스크립트 컴파일러의 동작

### 1. 코드 검사기로서의 타입스크립트 컴파일러

- 타입스크립트는 컴파일 타임에 코드 타입을 확인하기 때문에 코드를 실행하지 않고도 오류가 있다는 것을 알 수 있다.
- 타입스크립트는 코드를 실행하기 전에 에러를 사정에 발견하여 알려준다.
- 타입스크립트 컴파일러는 tsx binder 를 사용해서 타입 검사를 하고, 컴파일타임에 타입 오류를 발견한다.

### 2. 코드 변환기로서의 타입스크립트 컴파일러

- 타입스크립트 소스코드는 브라우저와 같은 런타임에서 실행될 수 없다. 자바스크립트 코드로 변환해야 실행할 수 있다.
- 타입스크립트 컴파일 이후에는 타입이 제거되어 순수한 자바스크립트 코드만 남는다. 그렇기 때문에 코드가 실행되는 런타임에는 타입 검사가 불가능하다.

## 3.3 타입스크립트 컴파일러의 구조

타입스크립트 컴파일러는 다섯 단계를 거쳐 타입 검사와 자바스크립트 소스 변환을 진행한다.

`스캐너 -> 파서 -> 바인더 -> 체커 -> 이미터`

### 1. 프로그램 (Program)

- 컴파일러는 tsconfig.json 에 명시된 컴파일 옵션을 기반으로 컴파일을 수행한다.
- 먼저 전체적인 컴파일 과정을 관리하는 프로그램 객체(인스턴스)가 생성된다.

### 2. 스캐너 (Scanner)

- 타입스크립트 소스를 자바스크립트로 변환하기 위한 첫 단계이다.
- 스캐너는 소스 코드를 작은 단위로 나누어 의미 있는 토큰으로 변환한다.

### 3. 파서 (Parser)

- 파서는 생성된 토큰을 활용해서 구문적 분석을 수행해 AST 를 생성한다.

### 4. 바인더 (Binder)

- 바인더는 타입 검사를 위해 심볼이라는 데이터 구조를 생성한다.
- 심볼은 이전 단계의 AST 에서 선언된 타입의 노드 정보를 저장한다.

### 5. 체커 (Checker)와 이미터 (Emitter)

- 체커는 파서가 생성한 AST 의 노드를 탐색하면서 바인더가 생성한 심볼 정보를 불러와 주어진 소스 파일에 대해 타입 검사를 수행한다.
- 전체 컴파일 과정에서 타입 검사가 차지하는 비중이 크다.
- 이미터는 타입스크립트 소스 파일을 변환하는 역할을 한다. 즉, 타입스크립트 소스를 자바스크립트 파일(js)과 타입 선언 파일(d.ts)로 생성한다.
