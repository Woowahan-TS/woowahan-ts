# 6장 타입스크립트 컴파일

### 목차

1. 컴파일타임과 런타임
2. 컴파일러의 동작 방식
3. 컴파일러의 구조 

## 1. 컴파일타임과 런타임
- 컴파일 타임 : TS 소스 코드가 JS 소스코드로 변환되는 단계
- 런타임 : 변환된 JS 소스코드가 메모리에 적재되어 실행되는 단계
- 자바스크립트는 대표적인 인터프리터 언어
- 그러나 V8 엔진에서는 코드 최적화를 위한 JIT 컴파일러가 동작
 (자주 사용되는 코드 등을 미리 머신 코드로 번역하고 캐싱해서 속도 최적화)
- 어쨌든 브라우저, Node.js 같은 환경을 자바스크립트가 실행되는 환경, 런타임이라고 함.
- 타입스크립트에서 tsc 라는 컴파일러가 TS -> JS 컴파일(트랜스파일) 을 진행
- 컴파일러가 소스코드를 변환할 때는 AST(추상 구문 트리)를 만들고, 이를 활용해 타입을 확인하고, JS 소스로 변환하게된다.
- 런타임에서는 다시 JS 소스를 가지고 AST 생성, 바이트코드 변환 및 평가/실행 단계를 거친다.
## 2. 컴파일러의 동작 방식
- 컴파일러의 역할은 코드에 타입 오류가 없는지를 확인하는 것.
- 코드를 정적으로 분석해 에러 검출, 실행 이전에 발생 가능한 에러를 사전에 알려줌.
- 그 뒤 구버전 JS 로 트랜스파일, tsconfig 의 target 옵션을 참조해 해당 버전의 JS 로 트랜스파일.
- 트랜스파일과 타입 검사는 독립적으로 동작, 코드 타이핑이 잘못되어서 발생하는 에러는 런타임 에러로 처리된다.
```ts
if(shape instanceof Rectangle)...
```
- 위 Rectangle 이 타입 영역에만 존재하는 것이라면, 타입영역과 값 영역은 구분되고 타입은 컴파일되며 사라지기 때문에 참조가 불가능 한 것.
## 3. 컴파일러의 구조 
- 컴파일러는 하나의 프로그램으로 이를 구현한 소스코드가 존재한다.
- 여러 영역으로 나뉘어 있는데, 다음과 같다.
    - 스캐너 Scanner    
    - 파서 Parser
    - 바인더 Binder
    - 체커 Checker
    - 이미터 Emitter
- 컴파일러에 실행 명령이 떨어지면,컴파일 과정을 관리하는 인스턴스가 생성
- 이 인스턴스가 소스파일, 소스파일 내에서 임포트 된 파일들을 불러오고 컴파일을 시작
- 스캐너 : 소스 파일을 어휘적으로 분석해 토큰을 생성
    - 소스코드를 작은 단위로 나누어 의미가 있는 토큰으로 변환
- 파서 : 스캐너 단계에서 생성된 토큰을 가지고 AST 를 생성
    - AST 는 소스코드 구조를 트리 형태로 표현한 것 (Abstract Syntax Tree)
    - 최상위 노드는 TS 소스파일, 최하위 노드는 파일의 끝 지점.
    - 각 노드는 코드상의 위치, 종류, 내용과 같은 문맥 정보를 담고있음
    - 그래서 각 토큰이 실질적으로 어떤 역할을 하는 코드인지 정보를 담게 ㅗ딤
- 바인더 : 체커가 타입을 검사할 수 있게 기반을 마련해줌
    - 기반은 심볼이라는 데이터 구조를 생성하는 것
    - AST 에서 선언된 타입의 노드 정보를 심볼에 저장
    - 이 심볼 자료구조에 각 식별자가 있어 이 심볼과 AST 노드를 연결하는 역할을 수행
- 체커 / 이미터 : 심볼을 활용한 타입 검사
    - AST 노드를 탐색하면서 심볼 정보를 불러와 소스파일에 대한 타입 검사를 수행
    - 체커 단계에서 타입 에러가 발생할 경우 이 에러에 대한 에러 메시지를 결정해 저장
    - 이미터는 소스파일 변환 역할을 담당