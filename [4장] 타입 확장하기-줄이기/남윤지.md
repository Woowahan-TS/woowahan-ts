# 4장 타입 확장하기 / 좁히기

## 4.1 타입 확장하기

타입 확장은 기존 타입을 사용해서 새로운 타입을 정의하는 것을 말한다.

### 1. 타입 확장의 장점

타입 확장의 가장 큰 장점은 중복 제거이다. 중복 제거 외에도 명시적인 코드 작성, 확장성이라는 장점을 가지고 있다.

### 2. 유니온 타입

유니온 타입은 2개 이상의 타입을 조합하여 사용하는 방식이다.

집합의 관점에서 합집합과 같은 개념으로 설명할 수 있는데. 유니온 타입에 포함된 모든 타입이 공통으로 가지고 있는 속성에만 접근할 수 있다.

```typescript
type MyUnion = A | B;
```

### 3. 교차 타입

교차 타입도 2개 이상의 타입을 조합하는데 유니온과는 다르게 교집합의 개념과 비슷하다.

예를 들어 A 타입과 B 타입의 교차타입인 C 는 A 와 B 의 모든 속성을 포함한 타입이 된다.

```typescript
type C = A & B;
```

### 4. extends와 교차 타입

유니온 타입과 교차 타입을 사용한 타입은 type 키워드로만 선언할 수 있다.

interface 타입의 경우는 extends 를 사용해서 교차 타입을 선언할 수 있다.

하지만 type 에서의 교차 타입과 차이점을 가지는데 아레 예시 코드와 같이 같은 이름의 속성이 다른 타입을 가진 경우 에러가 발생한다. extends 는 부모 interface 와 타입이 호환되어야 하기 때문에 에러가 발생한다.

```typescript
interface DeliveryTip {
  tip: number;
}

interface Filter extends DeliveryTip {
  tip: string;

  // Interface 'Filter' incorrectly extends interface 'DeliveryTip'
  // Types of property 'tip' are incompatible
  // Type 'string' is not assignable to type 'number'
}
```

### 5. 배달의민족 메뉴 시스템에 타입 확장 적용하기

> 타입 확장 시 하나의 타입에 여러 속성을 옵셔널한 값으로 추가하는 것 보다는 각 역할에 맞게 타입을 확장해 사용하면 적절한 네이밍을 사용해서 타입의 의도를 명확히 표현할 수도 있고, 코드 작성 단계에서 예기치 못한 버그도 예방할 수 있다.

## 4.2 타입 좁히기 - 타입 가드

타입 좁히기를 통해 더 정확하고 명시적인 타입 추론을 할 수 있고 타입 안정성을 높일 수 있다.

### 1. 타입 가드에 따라 분기 처리하기

타입 가드는 런타임에 조건문을 사용하여 타입을 검사하고 타입 범위를 좁혀주는 기능을 말한다.

컴파일 시 타입 정보는 모두 사라지기 때문에 런타임에 유효한 타입 가드를 만들기 위해 typeof, instanceof, in 과 같은 자바스크립트 연산자를 활용해서 타입 가드를 사용한다.

### 2. 원시 타입을 추론할 때 : typeof 연산자 활용하기

typeof 를 사용하면 원시 타입에 대해 추론할 수 있다.

자바스크립트의 동작 방식으로 인해 null 과 배열 타입 등이 object 타입으로 판별되는 경우가 있어 typeof 는 원시 타입을 좁히는 용도로만 시용하는 것이 권장된다.

> string, number, boolean, undefined, object, function, bigint, symbol

### 3. 인스턴스화된 객체 타입을 판별할 때 : instanceof 연산자 활용하기

instanceof 는 인스턴스화된 객체 타입을 판별하는 타입 가드로 사용할 수 있다.

`A instanceof B` 는 A 의 프로토타입 체인에 생성자 B 가 존재하는지를 검사해서 존재 여부를 boolean 으로 반환한다.

### 4. 객체의 속성이 있는지 없는지에 따른 구분 : in 연산자 활용하기

in 연산자는 객체의 속성이 있는지 확인한 다음 boolean 으로 반환한다.

`A in B` 는 A 라는 속성이 B 객체에 존재하는지를 검사한다.

in 연산자도 프로토타입 체인을 확인할 수 있다는 점에서 instanceof와 유사한 면이 있지만, 여전히 in은 속성 존재 여부를, instanceof는 객체의 타입을 확인하는 데 사용된다는 차이점이 있다.

### 5. is 연산자로 사용자 정의 타입 가드 만들어 활용하기

반환타입에 대해 타입 가드를 만들 수 있다.

`A is B` 의 형식으로 작성할 수 있는데 A 는 매개변수 이름이고 B 는 타입이다.

이 경우 반환값이 참일 때 A 매개변수의 타입을 B 타입으로 취급하게 된다.

## 4.3 타입 좁히기 - 식별할 수 있는 유니온(Discriminated Unions)

### 2. 식별할 수 있는 유니온

식별할 수 있는 유니온을 활용해 각 타입이 비슷한 구조를 가지지만 서로 호환되지 않도록 만들어 주기 위해서는 타입들이 서로 포함 관계를 가지지 않도록 정의할 수 있다.

`식별할 수 있는 유니온` 이란 타입 간의 구조 호환을 막기 위해 타입마다 구분할 수 있는 판별자를 달아 주어 포함 관계를 제거하는 것이다.

### 3. 식별할 수 있는 유니온의 판별자 선정

식별할 수 있는 유니온의 판별자는 유닛 타입으로 선언되어야 한다.

유닛 타입은 다른 타입으로 쪼개지지 않고 오직 하나의 정확한 값을 가지는 타입을 말한다. null, undefined, 리터럴 타입 등 정확한 값을 나타내는 타입이 해당된다.

## 4.4 Exhaustiveness Checking 으로 정확한 타입 분기 유지하기

Exhaustiveness 는 철저함, 완전함을 의미한다.

Exhaustiveness Checking 은 모든 케이스에 대해 철저하게 타입을 검사하는 것을 말한다.
